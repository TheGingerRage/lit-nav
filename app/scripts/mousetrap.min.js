/**
 * Copyright 2013 Craig Campbell
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Mousetrap is a simple keyboard shortcut library for Javascript with
 * no external dependencies
 *
 * @version 1.4.4
 * @url craig.is/killing/mice
 */
(function(){function e(e){function v(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false);return}e.attachEvent("on"+t,n)}function m(e){if(e.type=="keypress"){var r=String.fromCharCode(e.which);if(!e.shiftKey){r=r.toLowerCase()}return r}if(t[e.which]){return t[e.which]}if(n[e.which]){return n[e.which]}return String.fromCharCode(e.which).toLowerCase()}function g(e,t){return e.sort().join(",")===t.sort().join(",")}function y(e){e=e||{};var t=false,n;for(n in a){if(e[n]){t=true;continue}a[n]=0}if(!t){h=false}}function b(e,t,n,r,i,s){var u,f,l=[],c=n.type;if(!o[e]){return[]}if(c=="keyup"&&T(e)){t=[e]}for(u=0;u<o[e].length;++u){f=o[e][u];if(!r&&f.seq&&a[f.seq]!=f.level){continue}if(c!=f.action){continue}if(c=="keypress"&&!n.metaKey&&!n.ctrlKey||g(t,f.modifiers)){var h=!r&&f.combo==i;var p=r&&f.seq==r&&f.level==s;if(h||p){o[e].splice(u,1)}l.push(f)}}return l}function w(e){var t=[];if(e.shiftKey){t.push("shift")}if(e.altKey){t.push("alt")}if(e.ctrlKey){t.push("ctrl")}if(e.metaKey){t.push("meta")}return t}function E(e,t,n){if(p.stopCallback(t,t.target||t.srcElement,n)){return}if(e(t,n)===false){if(t.preventDefault){t.preventDefault()}if(t.stopPropagation){t.stopPropagation()}t.returnValue=false;t.cancelBubble=true}}function S(e,t,n){var r=b(e,t,n),i,s={},o=0,u=false;for(i=0;i<r.length;++i){if(r[i].seq){o=Math.max(o,r[i].level)}}for(i=0;i<r.length;++i){if(r[i].seq){if(r[i].level!=o){continue}u=true;s[r[i].seq]=1;E(r[i].callback,n,r[i].combo);continue}if(!u){E(r[i].callback,n,r[i].combo)}}var a=n.type=="keypress"&&c;if(n.type==h&&!T(e)&&!a){y(s)}c=u&&n.type=="keydown"}function x(e){if(typeof e.which!=="number"){e.which=e.keyCode}var t=m(e);if(!t){return}if(e.type=="keyup"&&l===t){l=false;return}p.handleKey(t,w(e),e)}function T(e){return e=="shift"||e=="ctrl"||e=="alt"||e=="meta"}function N(){clearTimeout(f);f=setTimeout(y,1e3)}function C(){if(!s){s={};for(var e in t){if(e>95&&e<112){continue}if(t.hasOwnProperty(e)){s[t[e]]=e}}}return s}function k(e,t,n){if(!n){n=C()[e]?"keydown":"keypress"}if(n=="keypress"&&t.length){n="keydown"}return n}function L(e,t,n,r){function i(t){return function(){h=t;++a[e];N()}}function s(t){E(n,t,e);if(r!=="keyup"){l=m(t)}setTimeout(y,10)}a[e]=0;for(var o=0;o<t.length;++o){var u=o+1===t.length;var f=u?s:i(r||O(t[o+1]).action);M(t[o],f,r,e,o)}}function A(e){if(e==="+"){return["+"]}return e.split("+")}function O(e,t){var n,s,o,u=[];n=A(e);for(o=0;o<n.length;++o){s=n[o];if(i[s]){s=i[s]}if(t&&t!="keypress"&&r[s]){s=r[s];u.push("shift")}if(T(s)){u.push(s)}}t=k(s,u,t);return{key:s,modifiers:u,action:t}}function M(e,t,n,r,i){u[e+":"+n]=t;e=e.replace(/\s+/g," ");var s=e.split(" "),a;if(s.length>1){L(e,s,t,n);return}a=O(e,n);o[a.key]=o[a.key]||[];b(a.key,a.modifiers,{type:a.action},r,e,i);o[a.key][r?"unshift":"push"]({callback:t,modifiers:a.modifiers,action:a.action,seq:r,level:i,combo:e})}function _(e,t,n){for(var r=0;r<e.length;++r){M(e[r],t,n)}}var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},n={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},i={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},s,o={},u={},a={},f,l=false,c=false,h=false,p;for(var d=1;d<20;++d){t[111+d]="f"+d}for(d=0;d<=9;++d){t[d+96]=d}v(e,"keypress",x);v(e,"keydown",x);v(e,"keyup",x);p={bind:function(e,t,n){e=e instanceof Array?e:[e];_(e,t,n);return this},unbind:function(e,t){return p.bind(e,function(){},t)},trigger:function(e,t){if(u[e+":"+t]){u[e+":"+t]({},e)}return this},reset:function(){o={};u={};return this},stopCallback:function(t,n){if((" "+n.className+" ").indexOf(" mousetrap ")>-1){return false}if(n==e){return false}return n.tagName=="INPUT"||n.tagName=="SELECT"||n.tagName=="TEXTAREA"||n.contentEditable&&n.contentEditable=="true"},handleKey:S};return p}var t=e(document);t.wrap=e;window.Mousetrap=t;if(typeof define==="function"&&define.amd){define(t)}})()